services:
  db:
    # expose Postgres for tools like Postico
    ports:
      - '5433:5432'

  # api:
  #   env_file:
  #     - ./.env
  #     - ./.env.development
  #   # bind API to localhost:4000 on your Mac
  #   ports:
  #     - '127.0.0.1:${API_PORT}:${API_PORT}'
  #   volumes:
  #     - ./api:/usr/src/app
  #   # override CMD from Dockerfile for dev:
  #   command: ['yarn', 'watch']

  # if your api/.env has DB_HOST=localhost, this still gets overridden by
  # DB_HOST=db from the base compose file

  client:
    build:
      context: ./
      args:
        BUILD_ENV: development # Skip build stage
    env_file:
      - ./.env
      - ./.env.development
    # bind Next to localhost:3000 on your Mac
    ports:
      - '127.0.0.1:${CLIENT_PORT}:${CLIENT_PORT}'

    # override API URL for local dev (if youâ€™re not using nginx/local domains)
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_APP_BASE_URL: http://localhost:${CLIENT_PORT}
    volumes:
      - .:/app
      - /app/node_modules # Preserve node_modules from image
      - /app/.next # Preserve .next if you want to cache it
    # override CMD from Dockerfile for dev:
    command: ['yarn', 'dev']
