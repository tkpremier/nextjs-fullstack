services:
  api:
    env_file:
      - ./.env
      - ./.env.production
    environment:
      NODE_ENV: ${NODE_ENV}

  client:
    env_file:
      - ./.env
      - ./.env.production
    environment:
      NODE_ENV: ${NODE_ENV}
      NEXT_PUBLIC_CLIENTURL: ${NEXT_PUBLIC_CLIENTURL}

  caddy:
    image: caddy:2.8
    restart: unless-stopped
    ports: ['80:80', '443:443']
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
      - caddy_config:/config
    depends_on: [client, api]
    networks:
      - tk_net # ðŸ‘ˆ attach to the same network as api/client

volumes:
  caddy_data:
  caddy_config:

networks:
  tk_net: # ðŸ‘ˆ must match the network name used by api/client/db in base file
    external: false
